directory=$(shell basename $(CURDIR))
num_levels=3

all:
	@echo ""

.PHONY:\
all distr_response\
distr_update_response\
distr_response_summary\
distr_performance\
distr_performance_figures\
distr_clean_performance_figures\
distr_clean_performance

distr_response: response/all_responses_obtained

response/all_responses_obtained:\
response/gm1/empty_target_file\
response/gm2/empty_target_file\
response/gm3/empty_target_file\
response/gm4/empty_target_file\
response/gm5/empty_target_file\
response/gm6/empty_target_file\
response/gm7/empty_target_file\
response/gm8/empty_target_file\
response/gm9/empty_target_file\
response/gm10/empty_target_file\
response/gm11/empty_target_file\
response/gm12/empty_target_file\
response/gm13/empty_target_file
	@touch response/all_responses_obtained

response/gm%/empty_target_file: ground_motions/parsed/empty_target_file ../../src/response.py ../../src/building.pcl
	@python ../../src/response.py '--building' '../../src/building.pcl' '--gm_dir' 'ground_motions/parsed' '--gm_dt' '0.005' '--analysis_dt' '0.01' '--gm_number' '$*' '--output_dir' 'response/gm$*'
	@touch response/gm$*/empty_target_file

distr_clean_response:
	rm -rf response

distr_update_response:
	@touch response/gm1/empty_target_file
	@touch response/gm2/empty_target_file
	@touch response/gm3/empty_target_file
	@touch response/gm4/empty_target_file
	@touch response/gm5/empty_target_file
	@touch response/gm6/empty_target_file
	@touch response/gm7/empty_target_file
	@touch response/gm8/empty_target_file
	@touch response/gm9/empty_target_file
	@touch response/gm10/empty_target_file
	@touch response/gm11/empty_target_file
	@touch response/gm12/empty_target_file
	@touch response/gm13/empty_target_file

distr_response_summary: response_summary/response.csv

response_summary/response.csv: ../../src/response_vectors.py response/all_responses_obtained
	@python ../../src/response_vectors.py '--input_dir' 'response' '--output_dir' 'response_summary' '--num_levels' '$(num_levels)'

distr_clean_response_summary:
	@rm -rf response_summary


distr_performance:\
performance/A/DL_summary.csv\
performance/B/DL_summary.csv\
performance/C/DL_summary.csv\
performance/D/DL_summary.csv\
performance/E/DL_summary.csv\
performance/F/DL_summary.csv

performance/A/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/A
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/A' '--c_gm_beta' '1.00' '--c_ds_beta' '1.00' '--c_rc_beta' '1.00'

performance/B/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/B
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/B' '--c_gm_beta' '0.0000001' '--c_ds_beta' '1.00' '--c_rc_beta' '1.00'

performance/C/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/C
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/C' '--c_gm_beta' '1.0' '--c_ds_beta' '0.0000001' '--c_rc_beta' '1.00'

performance/D/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/D
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/D' '--c_gm_beta' '1.0' '--c_ds_beta' '1.00' '--c_rc_beta' '0.0000001'

performance/E/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/E
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/E' '--c_gm_beta' '1.0' '--c_ds_beta' '0.0000001' '--c_rc_beta' '0.0000001'

performance/F/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/F
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/F' '--c_gm_beta' '0.0000001' '--c_ds_beta' '0.0000001' '--c_rc_beta' '0.0000001'

distr_performance_figures:\
../../figures/$(directory)/performance/total_cost_A.pdf\
../../figures/$(directory)/performance/total_cost_B.pdf\
../../figures/$(directory)/performance/total_cost_C.pdf\
../../figures/$(directory)/performance/total_cost_D.pdf\
../../figures/$(directory)/performance/total_cost_E.pdf\
../../figures/$(directory)/performance/total_cost_F.pdf\
../../figures/$(directory)/performance/total_cost_A-B.pdf\
../../figures/$(directory)/performance/total_cost_A-C.pdf\
../../figures/$(directory)/performance/total_cost_A-D.pdf\
../../figures/$(directory)/performance/total_cost_A-E.pdf\
../../figures/$(directory)/performance/total_cost_A-F.pdf\
../../figures/$(directory)/performance/component_costs_A.html


../../figures/$(directory)/performance/total_cost_%.pdf: performance/%/DL_summary.csv ../../src/performance_figures/single.py
	@mkdir -p ../../figures/$(directory)/performance && cd ../../ && python src/performance_figures/single.py '--DL_summary_path' 'analysis/$(directory)/performance/$*/DL_summary.csv' '--output_path' 'figures/$(directory)/performance/total_cost_$*.pdf'

../../figures/$(directory)/performance/total_cost_A-%.pdf: performance/A/DL_summary.csv performance/%/DL_summary.csv ../../src/performance_figures/multiple.py
	@mkdir -p ../../figures/$(directory)/performance && cd ../../ && python src/performance_figures/multiple.py '--DL_summary_path1' 'analysis/$(directory)/performance/A/DL_summary.csv' '--DL_summary_path2' 'analysis/$(directory)/performance/$*/DL_summary.csv' '--label_1' 'A' '--label_2' '$*'  '--output_path' 'figures/$(directory)/performance/total_cost_A-$*.pdf'

../../figures/$(directory)/performance/component_costs_%.html: performance/%/DL_summary.csv ../../src/performance_figures/cost_agg.py
	@mkdir -p ../../figures/$(directory)/performance && cd ../../ && python src/performance_figures/cost_agg.py '--DV_rec_cost_agg_path' 'analysis/$(directory)/performance/$*/DV_rec_cost_agg.csv' '--output_path' 'figures/$(directory)/performance/component_costs_$*.html'

distr_clean_performance_figures:
	@rm -rf ../../figures/$(directory)/performance

distr_clean_performance:
	@rm -rf performance
