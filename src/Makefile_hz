directory=$(shell basename $(CURDIR))
num_levels=3

all:
	@echo ""

.PHONY:\
all distr_response\
distr_update_response\
distr_response_summary\
distr_performance\
distr_performance_figures\
distr_response_TH_figures

distr_ground_motions: ground_motions/parsed/ground_motions_parsed

ground_motions/parsed/ground_motions_parsed : ground_motions/peer_raw/_SearchResults.csv ../../src/parse_gms.py ../../src/ground_motion_utils.py
	@python ../../src/parse_gms.py '--input_dir' 'ground_motions/peer_raw' '--output_dir' 'ground_motions/parsed' '--plot_dir' '../../figures/$(directory)/ground_motions'
	@touch ground_motions/parsed/ground_motions_parsed

distr_response: response/all_responses_obtained

response/all_responses_obtained:\
response/gm1/response_obtained\
response/gm2/response_obtained\
response/gm3/response_obtained\
response/gm4/response_obtained\
response/gm5/response_obtained\
response/gm6/response_obtained\
response/gm7/response_obtained\
response/gm8/response_obtained\
response/gm9/response_obtained\
response/gm10/response_obtained\
response/gm11/response_obtained\
response/gm12/response_obtained\
response/gm13/response_obtained
	@touch response/all_responses_obtained

response/gm%/response_obtained: ground_motions/parsed/ground_motions_parsed ../../src/response.py
	@python ../../src/response.py '--gm_dir' 'ground_motions/parsed' '--gm_dt' '0.005' '--analysis_dt' '0.1' '--gm_number' '$*' '--output_dir' 'response/gm$*'
	@touch response/gm$*/response_obtained

distr_response_summary: response_summary/response.csv

response_summary/response.csv: ../../src/response_vectors.py response/all_responses_obtained
	@python ../../src/response_vectors.py '--input_dir' 'response' '--output_dir' 'response_summary' '--num_levels' '$(num_levels)'


distr_response_TH_figures: distr_response_TH_figures_generated

distr_response_TH_figures_generated:\
../../figures/$(directory)/response/gm1/FA.pdf\
../../figures/$(directory)/response/gm2/FA.pdf\
../../figures/$(directory)/response/gm3/FA.pdf\
../../figures/$(directory)/response/gm4/FA.pdf\
../../figures/$(directory)/response/gm5/FA.pdf\
../../figures/$(directory)/response/gm6/FA.pdf\
../../figures/$(directory)/response/gm7/FA.pdf\
../../figures/$(directory)/response/gm8/FA.pdf\
../../figures/$(directory)/response/gm9/FA.pdf\
../../figures/$(directory)/response/gm10/FA.pdf\
../../figures/$(directory)/response/gm11/FA.pdf\
../../figures/$(directory)/response/gm12/FA.pdf\
../../figures/$(directory)/response/gm13/FA.pdf\
../../figures/$(directory)/response/gm1/ID.pdf\
../../figures/$(directory)/response/gm2/ID.pdf\
../../figures/$(directory)/response/gm3/ID.pdf\
../../figures/$(directory)/response/gm4/ID.pdf\
../../figures/$(directory)/response/gm5/ID.pdf\
../../figures/$(directory)/response/gm6/ID.pdf\
../../figures/$(directory)/response/gm7/ID.pdf\
../../figures/$(directory)/response/gm8/ID.pdf\
../../figures/$(directory)/response/gm9/ID.pdf\
../../figures/$(directory)/response/gm10/ID.pdf\
../../figures/$(directory)/response/gm11/ID.pdf\
../../figures/$(directory)/response/gm12/ID.pdf\
../../figures/$(directory)/response/gm13/ID.pdf\
../../figures/$(directory)/response/gm1/FV.pdf\
../../figures/$(directory)/response/gm2/FV.pdf\
../../figures/$(directory)/response/gm3/FV.pdf\
../../figures/$(directory)/response/gm4/FV.pdf\
../../figures/$(directory)/response/gm5/FV.pdf\
../../figures/$(directory)/response/gm6/FV.pdf\
../../figures/$(directory)/response/gm7/FV.pdf\
../../figures/$(directory)/response/gm8/FV.pdf\
../../figures/$(directory)/response/gm9/FV.pdf\
../../figures/$(directory)/response/gm10/FV.pdf\
../../figures/$(directory)/response/gm11/FV.pdf\
../../figures/$(directory)/response/gm12/FV.pdf\
../../figures/$(directory)/response/gm13/FV.pdf
	@touch distr_response_TH_figures_generated

distr_response_TH_figures_merged:\
../../figures/$(directory)/response/merged/FA.pdf\
../../figures/$(directory)/response/merged/FV.pdf\
../../figures/$(directory)/response/merged/ID.pdf

../../figures/$(directory)/response/merged/%: distr_response_TH_figures_generated
	@bash -c "mkdir -p ../../figures/$(directory)/response/merged && gs -dNOPAUSE -sDEVICE=pdfwrite -sOUTPUTFILE=../../figures/$(directory)/response/merged/$* -dBATCH $$(find ../../figures/$(directory)/response -name '$*' | sort | tr '\n' ' ')"

../../figures/$(directory)/response/gm%/FA.pdf: response/all_responses_obtained ../../src/response_figures_TH.py
	@mkdir -p ../../figures/$(directory)/response/gm$* && python ../../src/response_figures_TH.py '--input_dir' 'response/gm$*' '--fig_type' 'FA' '--output_filename' '../../figures/$(directory)/response/gm$*/FA.pdf' '--num_levels' '$(num_levels)'

../../figures/$(directory)/response/gm%/ID.pdf: response/all_responses_obtained ../../src/response_figures_TH.py
	@mkdir -p ../../figures/$(directory)/response/gm$* && python ../../src/response_figures_TH.py '--input_dir' 'response/gm$*' '--fig_type' 'ID' '--output_filename' '../../figures/$(directory)/response/gm$*/ID.pdf' '--num_levels' '$(num_levels)'

../../figures/$(directory)/response/gm%/FV.pdf: response/all_responses_obtained ../../src/response_figures_TH.py
	@mkdir -p ../../figures/$(directory)/response/gm$* && python ../../src/response_figures_TH.py '--input_dir' 'response/gm$*' '--fig_type' 'FV' '--output_filename' '../../figures/$(directory)/response/gm$*/FV.pdf' '--num_levels' '$(num_levels)'








distr_performance:\
performance/A/DL_summary.csv\
performance/B/DL_summary.csv\
performance/C/DL_summary.csv\
performance/D/DL_summary.csv\
performance/E/DL_summary.csv\
performance/F/DL_summary.csv

performance/A/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/A
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/A' '--c_gm_beta' '1.00' '--c_ds_beta' '1.00' '--c_rc_beta' '1.00'

performance/B/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/B
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/B' '--c_gm_beta' '0.0000001' '--c_ds_beta' '1.00' '--c_rc_beta' '1.00'

performance/C/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/C
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/C' '--c_gm_beta' '1.0' '--c_ds_beta' '0.0000001' '--c_rc_beta' '1.00'

performance/D/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/D
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/D' '--c_gm_beta' '1.0' '--c_ds_beta' '1.00' '--c_rc_beta' '0.0000001'

performance/E/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/E
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/E' '--c_gm_beta' '1.0' '--c_ds_beta' '0.0000001' '--c_rc_beta' '0.0000001'

performance/F/DL_summary.csv : response_summary/response.csv ../../pelicun/pelicun/tools/DL_calculation.py ../../src/DL_input.json ../../src/component_data/*.json 
	@mkdir -p performance/F
	@python ../../pelicun/pelicun/tools/DL_calculation.py '--filenameDL' '../../src/DL_input.json' '--filenameEDP' 'response_summary/response.csv' '--dirnameOutput' 'performance/F' '--c_gm_beta' '0.0000001' '--c_ds_beta' '0.0000001' '--c_rc_beta' '0.0000001'

distr_performance_figures:\
../../figures/$(directory)/performance/total_cost_A.pdf\
../../figures/$(directory)/performance/total_cost_B.pdf\
../../figures/$(directory)/performance/total_cost_C.pdf\
../../figures/$(directory)/performance/total_cost_D.pdf\
../../figures/$(directory)/performance/total_cost_E.pdf\
../../figures/$(directory)/performance/total_cost_F.pdf\
../../figures/$(directory)/performance/total_cost_A-B.pdf\
../../figures/$(directory)/performance/total_cost_A-C.pdf\
../../figures/$(directory)/performance/total_cost_A-D.pdf\
../../figures/$(directory)/performance/total_cost_A-E.pdf\
../../figures/$(directory)/performance/total_cost_A-F.pdf\
../../figures/$(directory)/performance/component_costs_A.html


../../figures/$(directory)/performance/total_cost_%.pdf: performance/%/DL_summary.csv ../../src/performance_figures/single.py
	@mkdir -p ../../figures/$(directory)/performance && cd ../../ && python src/performance_figures/single.py '--DL_summary_path' 'analysis/$(directory)/performance/$*/DL_summary.csv' '--output_path' 'figures/$(directory)/performance/total_cost_$*.pdf'

../../figures/$(directory)/performance/total_cost_A-%.pdf: performance/A/DL_summary.csv performance/%/DL_summary.csv ../../src/performance_figures/multiple.py
	@mkdir -p ../../figures/$(directory)/performance && cd ../../ && python src/performance_figures/multiple.py '--DL_summary_path1' 'analysis/$(directory)/performance/A/DL_summary.csv' '--DL_summary_path2' 'analysis/$(directory)/performance/$*/DL_summary.csv' '--label_1' 'A' '--label_2' '$*'  '--output_path' 'figures/$(directory)/performance/total_cost_A-$*.pdf'

../../figures/$(directory)/performance/component_costs_%.html: performance/%/DL_summary.csv ../../src/performance_figures/cost_agg.py
	@mkdir -p ../../figures/$(directory)/performance && cd ../../ && python src/performance_figures/cost_agg.py '--DV_rec_cost_agg_path' 'analysis/$(directory)/performance/$*/DV_rec_cost_agg.csv' '--output_path' 'figures/$(directory)/performance/component_costs_$*.html'
